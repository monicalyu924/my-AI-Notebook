<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾…åŠäº‹é¡¹åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .success { border-color: #4CAF50; background-color: #f8fff8; }
        .error { border-color: #f44336; background-color: #fff8f8; }
        .info { border-color: #2196F3; background-color: #f8f9ff; }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #005a8b; }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ AIç¬”è®°æœ¬å¾…åŠäº‹é¡¹åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section info">
        <h2>ğŸ“‹ æµ‹è¯•æ¦‚è¿°</h2>
        <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•å¾…åŠäº‹é¡¹åŠŸèƒ½çš„å„ä¸ªç»„ä»¶æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p>
        <p><strong>å‰ç«¯åœ°å€ï¼š</strong> <a href="http://localhost:5174" target="_blank">http://localhost:5174</a></p>
        <p><strong>åç«¯åœ°å€ï¼š</strong> <a href="http://localhost:8000" target="_blank">http://localhost:8000</a></p>
    </div>

    <div class="test-section">
        <h2>ğŸ”— 1. æœåŠ¡å™¨è¿æ¥æµ‹è¯•</h2>
        <button onclick="testServers()">æµ‹è¯•æœåŠ¡å™¨çŠ¶æ€</button>
        <div id="server-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ” 2. ç”¨æˆ·ç™»å½•æµ‹è¯•</h2>
        <input type="email" id="email" placeholder="é‚®ç®±" value="test@example.com">
        <input type="password" id="password" placeholder="å¯†ç " value="password123">
        <button onclick="testLogin()">æµ‹è¯•ç™»å½•</button>
        <div id="login-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“ 3. ç¬”è®°è·å–æµ‹è¯•</h2>
        <button onclick="testNotes()">è·å–ç¬”è®°åˆ—è¡¨</button>
        <div id="notes-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>âœ… 4. å¾…åŠäº‹é¡¹è§£ææµ‹è¯•</h2>
        <textarea id="todo-content" rows="6" cols="60" placeholder="è¾“å…¥åŒ…å«å¾…åŠäº‹é¡¹çš„Markdownå†…å®¹">
# æµ‹è¯•ç¬”è®°

## å¾…åŠäº‹é¡¹
- [ ] å®Œæˆé¡¹ç›®æŠ¥å‘Š !high @æ˜å¤© #å¼ ä¸‰
- [x] å®Œæˆä»£ç å®¡æŸ¥ !medium @ä»Šå¤©
- [ ] å‡†å¤‡ä¼šè®®ææ–™ !low @ä¸‹å‘¨ #å›¢é˜Ÿ

## å…¶ä»–å†…å®¹
è¿™æ˜¯ä¸€äº›æ™®é€šçš„æ–‡æœ¬å†…å®¹ã€‚
        </textarea>
        <br>
        <button onclick="testTodoParsing()">æµ‹è¯•å¾…åŠè§£æ</button>
        <div id="todo-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ¯ 5. ç»„ä»¶åŠ è½½æµ‹è¯•</h2>
        <button onclick="testComponentLoading()">æ£€æŸ¥å‰ç«¯ç»„ä»¶</button>
        <div id="component-result" class="result"></div>
    </div>

    <script>
        let authToken = '';

        async function testServers() {
            const result = document.getElementById('server-result');
            result.innerHTML = 'æ­£åœ¨æµ‹è¯•æœåŠ¡å™¨è¿æ¥...\n';

            try {
                // æµ‹è¯•å‰ç«¯
                const frontendResponse = await fetch('http://localhost:5174/', { method: 'HEAD' });
                result.innerHTML += `å‰ç«¯æœåŠ¡å™¨ (5174): ${frontendResponse.ok ? 'âœ… æ­£å¸¸' : 'âŒ å¼‚å¸¸'}\n`;
                
                // æµ‹è¯•åç«¯
                const backendResponse = await fetch('http://localhost:8000/health');
                const backendData = await backendResponse.json();
                result.innerHTML += `åç«¯æœåŠ¡å™¨ (8000): ${backendResponse.ok ? 'âœ… æ­£å¸¸' : 'âŒ å¼‚å¸¸'}\n`;
                result.innerHTML += `åç«¯å“åº”: ${JSON.stringify(backendData, null, 2)}\n`;
            } catch (error) {
                result.innerHTML += `âŒ è¿æ¥é”™è¯¯: ${error.message}\n`;
            }
        }

        async function testLogin() {
            const result = document.getElementById('login-result');
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            result.innerHTML = 'æ­£åœ¨æµ‹è¯•ç™»å½•...\n';

            try {
                const response = await fetch('http://localhost:8000/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.access_token;
                    result.innerHTML += `âœ… ç™»å½•æˆåŠŸ\n`;
                    result.innerHTML += `Token: ${authToken.substring(0, 50)}...\n`;
                } else {
                    result.innerHTML += `âŒ ç™»å½•å¤±è´¥: ${data.detail}\n`;
                }
            } catch (error) {
                result.innerHTML += `âŒ ç™»å½•é”™è¯¯: ${error.message}\n`;
            }
        }

        async function testNotes() {
            const result = document.getElementById('notes-result');
            
            if (!authToken) {
                result.innerHTML = 'âŒ è¯·å…ˆç™»å½•è·å–token\n';
                return;
            }

            result.innerHTML = 'æ­£åœ¨è·å–ç¬”è®°åˆ—è¡¨...\n';

            try {
                const response = await fetch('http://localhost:8000/notes/', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML += `âœ… è·å–æˆåŠŸï¼Œå…± ${data.length} ç¯‡ç¬”è®°\n`;
                    result.innerHTML += `ç¬”è®°åˆ—è¡¨:\n${JSON.stringify(data, null, 2)}\n`;
                } else {
                    result.innerHTML += `âŒ è·å–å¤±è´¥: ${data.detail}\n`;
                }
            } catch (error) {
                result.innerHTML += `âŒ è¯·æ±‚é”™è¯¯: ${error.message}\n`;
            }
        }

        function testTodoParsing() {
            const result = document.getElementById('todo-result');
            const content = document.getElementById('todo-content').value;
            
            result.innerHTML = 'æ­£åœ¨è§£æå¾…åŠäº‹é¡¹...\n';

            try {
                // æ¨¡æ‹Ÿå‰ç«¯çš„å¾…åŠäº‹é¡¹è§£æé€»è¾‘
                const todoRegex = /^(\s*)-\s*\[([x\s])\]\s*(.+)$/gm;
                const todos = [];
                let match;

                while ((match = todoRegex.exec(content)) !== null) {
                    const [fullMatch, indent, checked, task] = match;
                    
                    // è§£æä»»åŠ¡å±æ€§
                    let cleanTask = task;
                    let priority = null;
                    let dueDate = null;
                    let assignee = null;

                    // æå–ä¼˜å…ˆçº§
                    const priorityMatch = cleanTask.match(/!\s*(high|medium|low)/i);
                    if (priorityMatch) {
                        priority = priorityMatch[1].toLowerCase();
                        cleanTask = cleanTask.replace(priorityMatch[0], '').trim();
                    }

                    // æå–æˆªæ­¢æ—¥æœŸ
                    const dueDateMatch = cleanTask.match(/@\s*(\d{4}-\d{2}-\d{2}|ä»Šå¤©|æ˜å¤©|ä¸‹å‘¨)/);
                    if (dueDateMatch) {
                        dueDate = dueDateMatch[1];
                        cleanTask = cleanTask.replace(dueDateMatch[0], '').trim();
                    }

                    // æå–è´Ÿè´£äºº
                    const assigneeMatch = cleanTask.match(/#\s*([^\s]+)/);
                    if (assigneeMatch) {
                        assignee = assigneeMatch[1];
                        cleanTask = cleanTask.replace(assigneeMatch[0], '').trim();
                    }

                    todos.push({
                        checked: checked === 'x',
                        task: cleanTask,
                        priority,
                        dueDate,
                        assignee,
                        raw: fullMatch
                    });
                }

                result.innerHTML += `âœ… è§£ææˆåŠŸï¼Œæ‰¾åˆ° ${todos.length} ä¸ªå¾…åŠäº‹é¡¹\n`;
                result.innerHTML += `è§£æç»“æœ:\n${JSON.stringify(todos, null, 2)}\n`;
                
                // ç»Ÿè®¡ä¿¡æ¯
                const completed = todos.filter(t => t.checked).length;
                const pending = todos.length - completed;
                result.innerHTML += `\nğŸ“Š ç»Ÿè®¡ä¿¡æ¯:\n`;
                result.innerHTML += `æ€»è®¡: ${todos.length}\n`;
                result.innerHTML += `å·²å®Œæˆ: ${completed}\n`;
                result.innerHTML += `å¾…å®Œæˆ: ${pending}\n`;

            } catch (error) {
                result.innerHTML += `âŒ è§£æé”™è¯¯: ${error.message}\n`;
            }
        }

        function testComponentLoading() {
            const result = document.getElementById('component-result');
            result.innerHTML = 'æ­£åœ¨æ£€æŸ¥å‰ç«¯ç»„ä»¶...\n';

            // æ£€æŸ¥å‰ç«¯é¡µé¢æ˜¯å¦å¯è®¿é—®
            const iframe = document.createElement('iframe');
            iframe.src = 'http://localhost:5174';
            iframe.style.display = 'none';
            
            iframe.onload = function() {
                result.innerHTML += 'âœ… å‰ç«¯é¡µé¢åŠ è½½æˆåŠŸ\n';
                result.innerHTML += 'å»ºè®®ï¼š\n';
                result.innerHTML += '1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:5174\n';
                result.innerHTML += '2. æ‰“å¼€å¼€å‘è€…å·¥å…·æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯\n';
                result.innerHTML += '3. æ£€æŸ¥Networkæ ‡ç­¾é¡µçš„ç½‘ç»œè¯·æ±‚\n';
                result.innerHTML += '4. å¦‚æœé¡µé¢ç©ºç™½ï¼Œå¯èƒ½æ˜¯Reactç»„ä»¶æ¸²æŸ“é—®é¢˜\n';
                document.body.removeChild(iframe);
            };

            iframe.onerror = function() {
                result.innerHTML += 'âŒ å‰ç«¯é¡µé¢åŠ è½½å¤±è´¥\n';
                result.innerHTML += 'è¯·æ£€æŸ¥å‰ç«¯æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ\n';
                document.body.removeChild(iframe);
            };

            document.body.appendChild(iframe);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒæœåŠ¡å™¨æµ‹è¯•
        window.onload = function() {
            testServers();
        };
    </script>
</body>
</html>
