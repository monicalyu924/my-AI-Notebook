# AlertManageré…ç½®æ–‡ä»¶
global:
  smtp_smarthost: '${SMTP_HOST}:587'
  smtp_from: 'alerts@ai-notebook.com'
  smtp_auth_username: '${SMTP_USERNAME}'
  smtp_auth_password: '${SMTP_PASSWORD}'
  smtp_auth_identity: '${SMTP_USERNAME}'

# æŠ‘åˆ¶è§„åˆ™
inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']

# è·¯ç”±é…ç½®
route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10m
  repeat_interval: 12h
  receiver: 'default-receiver'
  routes:
    # ç´§æ€¥å‘Šè­¦è·¯ç”±
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 5s
      repeat_interval: 5m
      
    # è­¦å‘Šå‘Šè­¦è·¯ç”±
    - match:
        severity: warning
      receiver: 'warning-alerts'
      group_wait: 30s
      repeat_interval: 30m
      
    # ä¿¡æ¯å‘Šè­¦è·¯ç”±
    - match:
        severity: info
      receiver: 'info-alerts'
      group_wait: 60s
      repeat_interval: 6h

    # æ•°æ®åº“ç›¸å…³å‘Šè­¦
    - match_re:
        alertname: .*Database.*
      receiver: 'database-alerts'
      
    # å®‰å…¨ç›¸å…³å‘Šè­¦
    - match_re:
        alertname: .*(Login|Unauthorized|Security).*
      receiver: 'security-alerts'
      repeat_interval: 15m

# æ¥æ”¶å™¨é…ç½®
receivers:
  # é»˜è®¤æ¥æ”¶å™¨
  - name: 'default-receiver'
    email_configs:
      - to: 'admin@ai-notebook.com'
        subject: '[AIè®°äº‹æœ¬] ç›‘æ§å‘Šè­¦ - {{ .GroupLabels.alertname }}'
        body: |
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å®ä¾‹: {{ .Labels.instance }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ if .EndsAt }}ç»“æŸæ—¶é—´: {{ .EndsAt.Format "2006-01-02 15:04:05" }}{{ end }}
          
          è¯¦ç»†ä¿¡æ¯:
          {{ range .Labels.SortedPairs }}{{ .Name }}: {{ .Value }}
          {{ end }}
          {{ end }}

  # ç´§æ€¥å‘Šè­¦æ¥æ”¶å™¨
  - name: 'critical-alerts'
    email_configs:
      - to: 'admin@ai-notebook.com, ops@ai-notebook.com'
        subject: '[ç´§æ€¥] AIè®°äº‹æœ¬ç³»ç»Ÿå‘Šè­¦ - {{ .GroupLabels.alertname }}'
        body: |
          ğŸš¨ ç´§æ€¥å‘Šè­¦ ğŸš¨
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å®ä¾‹: {{ .Labels.instance }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          
          è¯·ç«‹å³æ£€æŸ¥ç³»ç»ŸçŠ¶æ€ï¼
          {{ end }}
        headers:
          Priority: high
          X-Priority: 1
          
    # Slacké€šçŸ¥ï¼ˆå¦‚æœé…ç½®äº†ï¼‰
    slack_configs:
      - api_url: '${SLACK_WEBHOOK_URL}'
        channel: '#alerts'
        color: danger
        title: 'ğŸš¨ ç´§æ€¥ç³»ç»Ÿå‘Šè­¦'
        text: |
          {{ range .Alerts }}
          *å‘Šè­¦*: {{ .Annotations.summary }}
          *æè¿°*: {{ .Annotations.description }}
          *å®ä¾‹*: {{ .Labels.instance }}
          *æ—¶é—´*: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}

  # è­¦å‘Šå‘Šè­¦æ¥æ”¶å™¨
  - name: 'warning-alerts'
    email_configs:
      - to: 'admin@ai-notebook.com'
        subject: '[è­¦å‘Š] AIè®°äº‹æœ¬ç›‘æ§å‘Šè­¦ - {{ .GroupLabels.alertname }}'
        body: |
          âš ï¸ ç³»ç»Ÿè­¦å‘Š âš ï¸
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å®ä¾‹: {{ .Labels.instance }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}
          
    slack_configs:
      - api_url: '${SLACK_WEBHOOK_URL}'
        channel: '#monitoring'
        color: warning
        title: 'âš ï¸ ç³»ç»Ÿè­¦å‘Š'
        text: |
          {{ range .Alerts }}
          *å‘Šè­¦*: {{ .Annotations.summary }}
          *å®ä¾‹*: {{ .Labels.instance }}
          {{ end }}

  # ä¿¡æ¯å‘Šè­¦æ¥æ”¶å™¨
  - name: 'info-alerts'
    email_configs:
      - to: 'monitoring@ai-notebook.com'
        subject: '[ä¿¡æ¯] AIè®°äº‹æœ¬ç³»ç»Ÿé€šçŸ¥ - {{ .GroupLabels.alertname }}'
        body: |
          â„¹ï¸ ç³»ç»Ÿä¿¡æ¯ â„¹ï¸
          
          {{ range .Alerts }}
          é€šçŸ¥å†…å®¹: {{ .Annotations.summary }}
          è¯¦ç»†æè¿°: {{ .Annotations.description }}
          å®ä¾‹: {{ .Labels.instance }}
          æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}

  # æ•°æ®åº“å‘Šè­¦æ¥æ”¶å™¨
  - name: 'database-alerts'
    email_configs:
      - to: 'admin@ai-notebook.com, dba@ai-notebook.com'
        subject: '[æ•°æ®åº“] AIè®°äº‹æœ¬æ•°æ®åº“å‘Šè­¦ - {{ .GroupLabels.alertname }}'
        body: |
          ğŸ—„ï¸ æ•°æ®åº“å‘Šè­¦ ğŸ—„ï¸
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          æ•°æ®åº“å®ä¾‹: {{ .Labels.instance }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          
          è¯·ç«‹å³æ£€æŸ¥æ•°æ®åº“çŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡ï¼
          {{ end }}

  # å®‰å…¨å‘Šè­¦æ¥æ”¶å™¨
  - name: 'security-alerts'
    email_configs:
      - to: 'admin@ai-notebook.com, security@ai-notebook.com'
        subject: '[å®‰å…¨] AIè®°äº‹æœ¬å®‰å…¨å‘Šè­¦ - {{ .GroupLabels.alertname }}'
        body: |
          ğŸ”’ å®‰å…¨å‘Šè­¦ ğŸ”’
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          æ¥æº: {{ .Labels.instance }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          
          æ£€æµ‹åˆ°å¯èƒ½çš„å®‰å…¨å¨èƒï¼Œè¯·ç«‹å³è°ƒæŸ¥ï¼
          {{ end }}
        headers:
          Priority: high
          X-Priority: 1
          
    slack_configs:
      - api_url: '${SLACK_WEBHOOK_URL}'
        channel: '#security'
        color: danger
        title: 'ğŸ”’ å®‰å…¨å‘Šè­¦'
        text: |
          {{ range .Alerts }}
          *å®‰å…¨äº‹ä»¶*: {{ .Annotations.summary }}
          *æ¥æº*: {{ .Labels.instance }}
          *æ—¶é—´*: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}

# æ¨¡æ¿é…ç½®
templates:
  - '/etc/alertmanager/templates/*.tmpl'