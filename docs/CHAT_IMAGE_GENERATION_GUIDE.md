# 聊天界面集成 Nano Banana 图像生成使用指南

## 概述

现在您可以在聊天界面中直接使用 Nano Banana 模型生成 AI 图像！无需切换到专门的图像生成器页面，在与 AI 对话的同时就能创建精美的图像。

## 功能特点

### 1. 无缝集成
- **统一界面**：在聊天页面中切换模型即可使用图像生成功能
- **智能识别**：系统自动识别图像模型，调整提示词和显示方式
- **对话历史**：图像生成结果保存在对话历史中，方便查看和管理

### 2. 易用性提升
- **动态提示**：选择图像模型时，输入框自动显示图像描述提示
- **示例引导**：空白界面提供提示词示例，帮助用户快速上手
- **一键下载**：生成的图像可直接在聊天界面中下载

## 使用方法

### 步骤 1：配置 Google API 密钥

1. 访问 [设置页面](http://localhost:5173/settings)
2. 找到 "Google API Key" 输入框
3. 输入您的 Google API 密钥
4. 点击 "保存设置"

### 步骤 2：进入聊天界面

1. 在主界面中点击"AI 对话"
2. 或通过命令面板（Ctrl/Cmd + K）快速访问

### 步骤 3：选择 Nano Banana 模型

1. 点击右上角的模型选择器（显示当前模型名称）
2. 在下拉列表中找到 **🍌 Nano Banana (图像生成)**
3. 点击选择

### 步骤 4：输入图像描述并生成

1. 在输入框中输入您想生成的图像描述
2. 按 Enter 或点击发送按钮
3. 等待 5-30 秒，图像将显示在对话框中
4. 点击"下载图像"保存到本地

## 提示词技巧

### 基础结构
```
[主体] + [环境/背景] + [风格] + [细节]
```

### 优质示例

#### 1. 自然风景
```
一座雪山倒映在清澈的湖面上，黄昏时分，金色阳光，超高清摄影
```

#### 2. 人物肖像
```
一位优雅的女性，穿着维多利亚时代的礼服，在花园中，油画风格，柔和光线
```

#### 3. 科幻场景
```
未来主义的太空站，漂浮在土星环附近，闪烁的灯光，赛博朋克风格，4K 渲染
```

#### 4. 动物主题
```
一只金色的狐狸在秋天的森林里，落叶纷飞，暖色调，水彩画风格
```

#### 5. 建筑设计
```
现代极简主义别墅，玻璃外墙，面朝大海，日落时分，建筑摄影
```

### 关键词技巧

#### 风格关键词
- **摄影风格**：超高清、4K、8K、微距摄影、航拍
- **绘画风格**：油画、水彩、素描、插画、卡通
- **艺术流派**：印象派、抽象派、超现实主义、极简主义
- **时代风格**：复古、蒸汽朋克、赛博朋克、未来主义

#### 光线关键词
- 黄昏、日出、黄金时刻
- 柔和光线、戏剧性光线
- 背光、侧光、顶光
- 霓虹灯、烛光、星光

#### 情绪关键词
- 宁静、神秘、梦幻、温馨
- 史诗感、壮观、震撼
- 忧郁、欢快、浪漫

## 对话示例

### 示例 1：简单图像生成

**用户**：
```
一只可爱的猫咪坐在窗台上，阳光照进来
```

**Nano Banana**：
[显示生成的图像]
[下载图像] 按钮

---

### 示例 2：精细化描述

**用户**：
```
赛博朋克风格的东京街景，霓虹灯广告牌，雨后湿润的地面反射着彩色灯光，
夜晚，电影感构图，超高清，8K 渲染
```

**Nano Banana**：
[显示生成的高质量赛博朋克图像]
[下载图像] 按钮

---

## 界面功能说明

### 1. 模型选择器
- **位置**：聊天页面右上角
- **功能**：快速切换不同的 AI 模型
- **视觉标识**：Nano Banana 模型前有 🍌 图标

### 2. 空白状态提示
当选择 Nano Banana 模型且没有对话历史时，会显示：
- 紫色的图像图标
- "Nano Banana 图像生成"标题
- 简短的功能说明
- 3 个提示词示例

### 3. 输入框提示
- **文本模型**：显示"输入您的问题..."
- **图像模型**：显示"描述您想生成的图像，例如：一只可爱的猫咪坐在月球上..."

### 4. 图像显示
- **布局**：圆角卡片，最大宽度适配
- **信息**：显示生成时间
- **操作**：一键下载按钮

### 5. 对话历史
- 用户的提示词显示在右侧（蓝色背景）
- 生成的图像显示在左侧（白色背景）
- 支持滚动查看历史记录

## API 密钥检测

系统会智能检测您的 API 密钥配置：

### Nano Banana 模型
- **需要**：Google API 密钥
- **检测**：发送前检查 `user.google_api_key`
- **提示**：如未配置，显示"请先在设置中配置 Google API 密钥"

### 文本模型（Claude、GPT 等）
- **需要**：OpenRouter API 密钥
- **检测**：发送前检查 `user.openrouter_api_key`
- **提示**：如未配置，显示"请先在设置中配置 OpenRouter API 密钥"

## 技术实现细节

### 消息类型标识
```javascript
// 文本消息
{
  id: timestamp,
  content: "文本内容",
  role: 'user' | 'assistant',
  type: 'text',
  timestamp: ISO_string
}

// 图像消息
{
  id: timestamp,
  content: "base64_image_data",
  role: 'assistant',
  type: 'image',
  timestamp: ISO_string
}
```

### API 调用流程
```javascript
1. 检测模型类型 (text | image)
2. 验证对应的 API 密钥
3. 根据类型调用不同的 API：
   - 图像：POST /api/nano-banana/generate
   - 文本：POST /api/chat/quick (流式响应)
4. 解析响应并显示
```

### 图像渲染
```jsx
{message.type === 'image' ? (
  <img src={`data:image/jpeg;base64,${message.content}`} />
) : (
  <p>{message.content}</p>
)}
```

## 性能优化

### 1. 超时处理
- 图像生成请求默认无额外超时限制
- 依赖后端的 60 秒超时设置
- 建议：耐心等待，复杂图像可能需要 30-60 秒

### 2. 加载状态
- 发送请求后立即显示加载指示器
- "AI 正在思考中..." 提示
- 防止重复点击发送按钮

### 3. 错误处理
- 捕获网络错误和 API 错误
- 在对话框中显示友好的错误消息
- 不中断现有的对话历史

## 最佳实践

### 1. 提示词撰写
- ✅ **具体描述**：包含主体、环境、风格、细节
- ✅ **使用关键词**：光线、色调、风格、质量
- ❌ **避免模糊**："一张漂亮的图片"
- ❌ **避免矛盾**："黑白的彩色图像"

### 2. 迭代优化
1. 先用简单描述测试基本效果
2. 根据结果添加更多细节
3. 调整风格和光线关键词
4. 尝试不同的构图角度

### 3. 保存管理
- 及时下载满意的图像
- 对话历史中保留提示词，方便复用
- 可以清空对话重新开始

## 故障排除

### 问题 1：点击发送后无响应
**可能原因**：
- 未配置 Google API 密钥
- 网络连接问题

**解决方法**：
1. 检查设置页面中的 Google API 密钥
2. 打开浏览器开发者工具（F12）查看网络请求
3. 确认后端服务正在运行（端口 8000）

### 问题 2：显示错误消息
**常见错误**：
- "未配置 Google API 密钥"：前往设置页面配置
- "图像生成失败"：检查 API 密钥是否有效
- "API 调用失败"：可能是网络问题或 API 限额

**解决方法**：
1. 验证 API 密钥有效性
2. 检查 Google API 配额
3. 重试请求

### 问题 3：图像无法下载
**解决方法**：
1. 右键点击图像 → "图片另存为"
2. 检查浏览器的下载权限设置
3. 尝试不同的浏览器

## 与独立图像生成器的对比

| 功能 | 聊天界面 | 独立页面 (/image-generator) |
|------|----------|------------------------------|
| **便捷性** | ✅ 无需切换页面 | ⚠️ 需要单独访问 |
| **对话历史** | ✅ 保存在聊天记录 | ❌ 无历史记录 |
| **批量生成** | ❌ 一次1张 | ✅ 一次1-4张 |
| **图像编辑** | ❌ 不支持 | ✅ 支持图像编辑 |
| **负面提示** | ❌ 不支持 | ✅ 支持 |
| **适用场景** | 快速生成单张图像 | 专业图像创作 |

**建议**：
- **日常使用**：聊天界面快速生成
- **专业创作**：独立页面精细调整

## 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl/Cmd + K` | 打开命令面板 |
| `Enter` | 发送消息 |
| `Shift + Enter` | 换行 |

## 后续计划

### 即将支持的功能
1. **批量生成**：在聊天界面中一次生成多张变体
2. **图像编辑**：选择历史图像进行编辑
3. **提示词模板**：快速插入常用的提示词
4. **自动保存**：自动保存生成的图像到云端
5. **分享功能**：一键分享图像和提示词

### 反馈和建议
如有任何问题或建议，欢迎反馈！

---

**最后更新**：2025-10-22
**版本**：1.0.0
**作者**：AI Notebook Team
